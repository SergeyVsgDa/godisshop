<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://sergeyvsgda.github.io/godisshop.github.io/style.css">
    <script src="http://code.jquery.com/jquery-2.0.2.min.js"></script>
    <script src="https://application.vsegda-da.com/vd-online.js"></script>
</head>
<body>
<script>
    $(function () {
    // Submit Form Event
    var $form = $('.vd_form');
    $form.on('submit',(e)=>{
        e.preventDefault();
        let data = $form.serializeArray();
        let allInfo = {};
        $.each(data,function (i,d) {
            if (d.name == 'partnerCode') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'partnerGoodCatalog') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'patnerProductCode') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'vd_product_name') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'vd_delivery') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'firstName') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'lastName') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'phone') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'email') {
                allInfo[d.name] = d.value;
            }
            if (d.name == 'price') {
                allInfo[d.name] = Number(d.value);
            }
        })

        var collectInfo = {
            partnerCode: allInfo['partnerCode'],
            partnerProductCode: allInfo['patnerProductCode'],
            orderNum: 'vdrs-' + new Date().getTime(),
            clientInfo : [{
                "lastName" : allInfo['lastName'],
                "firstName" : allInfo['firstName'],
                "phone" : allInfo['phone'],
                "email" : allInfo['email'],
            }],
            items  : [{
                "name" : allInfo['vd_product_name'],
                "price" : Number(allInfo['price']),
                "quantity" : 1,
                "partnerGoodCatalog" : allInfo['partnerGoodCatalog'],
            }],
        };
        vd.create(collectInfo);
    })

    // Events
    $('.trigger_ico').on('click',()=>{
        $('.vd_popup').toggle('show');
    })

    // Pattern to digits
    $form.find('[name="price"], [name="phone"]').inputFilter(function(value) {
        return /^\d*$/.test(value);    // Allow digits only, using a RegExp
    });
})

$.fn.inputFilter = function(inputFilter) {
    return this.on("input keydown keyup mousedown mouseup select contextmenu drop", function() {
        if (inputFilter(this.value)) {
            this.oldValue = this.value;
            this.oldSelectionStart = this.selectionStart;
            this.oldSelectionEnd = this.selectionEnd;
        } else if (this.hasOwnProperty("oldValue")) {
            this.value = this.oldValue;
            this.setSelectionRange(this.oldSelectionStart, this.oldSelectionEnd);
        } else {
            this.value = "";
        }
    });
};

</script>

<div id="vd_widget">
    <img class="trigger_ico" src="kruglik.png">
    <div class="vd_popup invisible">
        <form class="vd_form" action="">
            <input type="text" name="partnerCode" value="S0090224" hidden>   <!-- Вставить ваш ПартнерКод-->
            <input type="text" name="partnerGoodCatalog" value="Нижнее бельё" hidden> <!-- Вставить вашу категорию товаров-->
            <input type="text" name="vd_product_name" value="Нижнее бельё godisshop" hidden> <!-- Вставить вашу категорию товаров-->
            <input type="text" name="vd_delivery" value="1" hidden>

            <input required type="text" class="vd-text" name="firstName" placeholder="Имя" />
            <input required type="text" class="vd-text" name="lastName" placeholder="Фамилия" />
            <input required type="text" class="vd-text" name="phone" placeholder="телефон" />
            <input required type="email" class="vd-text" name="email" placeholder="e-mail" />
            <input required type="text" class="vd-text" name="price" placeholder="от 3000 до 500 000 рублей">
            <select name="patnerProductCode" required class="vd-text">
                <option value="0-0-6;0-0-10;0-0-12;0-0-24">В Рассрочку на 6 10 12 или 24 месяца</option>
                <option value="Кредит">В кредит от 6 до 36 месяцев</option>
            </select>
<!--            <p><input checked type="checkbox" name="sms_info">SMS информирование</p>-->
<!--            <p><input type="checkbox" value="insurance">Страхование</p>-->
            <button class="VD_BUTTON" type="submit">Перейти к оформлению</button>
        </form>
    </div>
</div>


<footer>
  
</footer>
</body>
</html>
